{% assign is_always_show = false %}

{% if site.app.loader.always_show %}
  {% for always_path in site.app.loader.always_show %}
    {% assign normalized_always = always_path | replace: "/index.html","" | replace: "index.html","" | remove_first:"/" %}
    {% assign normalized_current = page.url | replace: "/index.html","" | replace: "index.html","" | remove_first:"/" %}

    {% if normalized_current == normalized_always %}
      {% assign is_always_show = true %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endif %}

<div id="page-loader" class="page-loader">
  <div id="loader-words"></div>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<script>
(function() {

  const isAlwaysShow = {{ is_always_show | jsonify }};

  const loader = document.getElementById("page-loader");
  const container = document.getElementById("loader-words");

  // ambil teks dari config
  {% if site.app.loader.custom_teks and site.app.loader.custom_teks.size > 0 %}
    let words = {{ site.app.loader.custom_teks | jsonify }};
  {% else %}
    let words = ["Loading", "Please wait"];
  {% endif %}

  // skip loader jika pernah ditampilkan di session ini (bukan always_show)
  if (!isAlwaysShow) {
    try {
      if (sessionStorage.getItem("loaderShown") === "true") {
        loader.remove();
        return;
      }
    } catch (e) {}
  }

  // generate elemen teks
  words.forEach(t => {
    const h1 = document.createElement("h1");
    h1.className = "header-text";
    h1.textContent = t;
    container.appendChild(h1);
  });

  // jalankan animasi setelah page fully load (agar smooth)
  window.addEventListener("load", function() {

    const tl = gsap.timeline();

    // animasi teks SAMA PERSIS versi index.html
    tl.to(".header-text", {
      y: "-100%",
      opacity: 1,
      duration: 0.75,
      ease: "power2.out",
      stagger: {
        each: 0.75,
        onComplete() {
          gsap.to(this.targets()[0], {
            y: "-200%",
            opacity: 0,
            duration: 0.75,
            ease: "power1.inOut"
          });
        }
      }
    });

    // fade out loader smooth
    tl.to("#page-loader", {
      opacity: 0,
      duration: 0.75,
      ease: "power1.inOut",
      onComplete() {
        loader.remove();
        if (!isAlwaysShow) {
          try { sessionStorage.setItem("loaderShown","true"); } catch (e) {}
        }
      }
    }, "+=0.4");

  });

})();
</script>
