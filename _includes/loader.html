{% assign is_always_show = false %}

{% if site.app.loader.always_show %}
  {% for always_path in site.app.loader.always_show %}
    {% assign normalized_always = always_path | replace: "/index.html","" | replace: "index.html","" | remove_first:"/" %}
    {% assign normalized_current = page.url | replace: "/index.html","" | replace: "index.html","" | remove_first:"/" %}

    {% if normalized_current == normalized_always %}
      {% assign is_always_show = true %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endif %}

<div id="page-loader" class="page-loader">
  <div id="loader-words"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<script>
(function() {

  const isAlwaysShow = {{ is_always_show | jsonify }};
  const loader = document.getElementById("page-loader");
  const container = document.getElementById("loader-words");

  /* Ambil teks dari config */
  {% if site.app.loader.custom_teks and site.app.loader.custom_teks.size > 0 %}
    let words = {{ site.app.loader.custom_teks | jsonify }};
  {% else %}
    let words = ["Loading", "Please wait"];
  {% endif %}

  /* Skip loader kalau sudah muncul sebelumnya (kecuali always_show) */
  if (!isAlwaysShow) {
    try {
      if (sessionStorage.getItem("loaderShown") === "true") {
        loader.remove();
        return;
      }
    } catch (e) {}
  }

  /* Generate elemen teks */
  words.forEach(t => {
    const h1 = document.createElement("h1");
    h1.className = "header-text";
    h1.textContent = t;
    container.appendChild(h1);
  });

  window.addEventListener("load", function() {

    const tl = gsap.timeline();

    /* ---------------------------------------------
       OPENING ANIMATION (baru ditambah)
       Loader fade-in + scale (kayak index.html)
    --------------------------------------------- */
    tl.from("#page-loader", {
      opacity: 0,
      scale: 0.95,
      duration: 0.8,
      ease: "cubic.inOut"
    });

    /* Delay sebelum animasi teks */
    tl.to({}, {duration: 0.2});

    /* ---------------------------------------------
       ANIMASI TEKS (SAMA dengan index.html)
    --------------------------------------------- */
    tl.to(".header-text", {
      y: "-100%",
      opacity: 1,
      duration: 0.85,
      ease: "cubic.out",
      stagger: {
        each: 0.8,
        onComplete() {
          gsap.to(this.targets()[0], {
            y: "-200%",
            opacity: 0,
            duration: 0.8,
            ease: "cubic.inOut"
          });
        }
      }
    });

    /* ---------------------------------------------
       FADE OUT LOADER
    --------------------------------------------- */
    tl.to("#page-loader", {
      opacity: 0,
      duration: 0.8,
      ease: "cubic.inOut",
      onComplete() {
        loader.remove();
        if (!isAlwaysShow) {
          try { sessionStorage.setItem("loaderShown", "true"); } catch (e) {}
        }
      }
    }, "+=0.3");

  });

})();
</script>
