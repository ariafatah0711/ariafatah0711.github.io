{% comment %}
Page Loader Component
Shows loading animation on page transitions
{% endcomment %}

{% assign is_always_show = false %}

{% if site.app.loader.always_show %}
  {% for always_path in site.app.loader.always_show %}
    {% assign normalized_always = always_path | replace: "/index.html","" | replace: "index.html","" | remove_first:"/" %}
    {% assign normalized_current = page.url | replace: "/index.html","" | replace: "index.html","" | remove_first:"/" %}

    {% if normalized_current == normalized_always %}
      {% assign is_always_show = true %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endif %}

<div id="page-loader" class="page-loader">
  <div id="loader-words"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<style>
  body.loader-active,
  html.loader-active {
    overflow: hidden;
  }
</style>

<script>
(function() {

  const isAlwaysShow = {{ is_always_show | jsonify }};
  const loader = document.getElementById("page-loader");
  const container = document.getElementById("loader-words");

  {% if site.app.loader.custom_teks and site.app.loader.custom_teks.size > 0 %}
    let words = {{ site.app.loader.custom_teks | jsonify }};
  {% else %}
    let words = ["Loading", "Please wait"];
  {% endif %}

  if (!isAlwaysShow) {
    try {
      if (sessionStorage.getItem("loaderShown") === "true") {
        loader.remove();
        return;
      }
    } catch (e) {}
  }

  // Hide overflow while loader is active
  document.documentElement.classList.add("loader-active");
  document.body.classList.add("loader-active");

  words.forEach(t => {
    const h1 = document.createElement("h1");
    h1.className = "header-text";
    h1.textContent = t;
    container.appendChild(h1);
  });

  window.addEventListener("load", function() {

    const tl = gsap.timeline();

    tl.from("#page-loader", {
      opacity: 0,
      scale: 0.95,
      duration: 0.8,
      ease: "cubic.inOut"
    });

    tl.to({}, {duration: 0.2});

    tl.to(".header-text", {
      y: "-100%",
      opacity: 1,
      duration: 0.85,
      ease: "cubic.out",
      stagger: {
        each: 0.8,
        onComplete() {
          gsap.to(this.targets()[0], {
            opacity: 0,
            duration: 0.3,
            ease: "cubic.inOut"
          });
        }
      }
    });

    tl.to("#page-loader", {
      opacity: 0,
      duration: 0.8,
      ease: "cubic.inOut",
      onComplete() {
        loader.remove();
        // Remove overflow hidden when loader is done
        document.documentElement.classList.remove("loader-active");
        document.body.classList.remove("loader-active");
        if (!isAlwaysShow) {
          try { sessionStorage.setItem("loaderShown", "true"); } catch (e) {}
        }
      }
    }, "+=0.3");

  });

})();
</script>
