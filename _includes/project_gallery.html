{% comment %} Project gallery include
   Expects `_data/projects.yml` with: title, description, image, source_url, demo_url, repo
{% endcomment %}

<div class="projects-gallery">
  <div class="projects-grid">
    {% for project in site.data.projects %}
    {% comment %} normalize images into img_list array {% endcomment %}
    {% if project.images %}
      {% if project.images.size %}
        {% assign img_list = project.images %}
      {% elsif project.images contains ',' %}
        {% assign img_list = project.images | split: ',' %}
      {% else %}
        {% assign img_list = project.images | split: ',' %}
      {% endif %}
    {% elsif project.image %}
      {% assign img_list = project.image | split: ',' %}
    {% else %}
      {% assign img_list = '' %}
    {% endif %}
    {% if img_list == '' %}
      {% assign img_list_json = '[]' %}
    {% else %}
      {% assign img_list_json = img_list | jsonify %}
    {% endif %}
  <div class="project-item" data-repo="{{ project.repo }}" data-source="{{ project.source_url | default: '' }}" data-demo="{{ project.demo_url | default: '' }}" data-images='{{ img_list_json }}' {% if project.videos or project.video %}data-video="{{ project.videos | default: project.video }}"{% endif %}>
      <div class="project-thumb">
        {% if project.image or project.images %}
          {% assign img = project.image | default: (project.images | first) %}
          {% if img contains 'http' %}
            {% include image.html src=img alt=project.title class="clickable-image" %}
          {% elsif img contains '.' %}
            {% include image.html src=img alt=project.title class="clickable-image" %}
          {% else %}
            {%- comment -%} fallback to site profile image when project.image has no extension {%- endcomment -%}
            {% include image.html src="/assets/images/profile2-128.avif" alt=project.title class="clickable-image" %}
          {% endif %}
          {% if project.videos or project.video %}
            <div class="play-overlay">▶</div>
          {% endif %}

          <!-- Stars overlay in top-right -->
          <div class="stars-overlay github-stars" data-repo="{{ project.repo }}" title="GitHub stars">
            ★ <span class="star-count">-</span>
          </div>
        {% else %}
          <div class="image-fallback"></div>
        {% endif %}
      </div>

      {%- comment -%} thumbnails row if multiple images provided in project.images {%- endcomment -%}
      {% if project.images %}
        <div class="project-thumbs-row">
          {% for thumb in img_list %}
            {% assign t = thumb %}
            {% if t contains 'http' %}
              {% include image.html src=t alt="thumb" class="project-thumb-img" onerror="this.style.display='none';" no_fallback=true %}
            {% elsif t contains '.' %}
              {% include image.html src=t alt="thumb" class="project-thumb-img" onerror="this.style.display='none';" no_fallback=true %}
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
      <div class="project-meta">
        <div class="gallery-title">{{ project.title }}</div>
        <div class="gallery-description">{{ project.description }}</div>
        <div class="project-links">
          <div class="links-row">
            {% if project.source_url %}<a class="btn small secondary" href="{{ project.source_url }}" target="_blank" rel="noopener">Source</a>{% endif %}
            {% if project.demo_url and project.demo_url != "" %}<a class="btn small primary" href="{{ project.demo_url }}" target="_blank" rel="noopener">Demo</a>{% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
</div>
</div>
